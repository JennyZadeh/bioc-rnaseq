---
source: Rmd
title: "Gene set analysis"
teaching: XX
exercises: XX
questions:
- "How do we find differentially expressed pathways?"
objectives:
- "Explain how to find differentially expressed pathways with gene set analysis in R."
- "Understand how differentially expressed genes can enrich a gene set."
- "Explain how to perform a gene set analysis in R, using clusterProfiler."
keypoints:
- "Key point 1"
---

```{r, echo=FALSE, purl=FALSE, message=FALSE}
source("download_data.R")
```

```{r, include=FALSE}
source("../bin/chunk-options.R")
knitr_fig_path("07-")
options(width = 120)
```

Recall the differential expression analysis.

```{r, message=FALSE}
library(SummarizedExperiment)
library(DESeq2)
```

```{r}
se <- readRDS("data/GSE96870_se.rds")
```

```{r}
dds <- DESeq2::DESeqDataSet(se[, se$tissue == "Cerebellum"],
                            design = ~ sex + time)
```

```{r, message=FALSE}
dds <- DESeq2::DESeq(dds)
```

Fetch results for the contrast between male and female mice.

```{r}
resSex <- DESeq2::results(dds, contrast = c("sex", "Male", "Female"))
summary(resSex)
```

Select differentially expressed (DE) genes between males and females
with FDR < 5%.

```{r}
sexDE <- as.data.frame(subset(resSex, padj < 0.05))
dim(sexDE)
sexDE <- sexDE[order(abs(sexDE$log2FoldChange), decreasing=TRUE), ]
head(sexDE)
sexDEgenes <- rownames(sexDE)
head(sexDEgenes)
length(sexDEgenes)
```

Build a gene set formed by genes located in the sex chromosomes X and Y.

```{r, message=FALSE}
xygenes <- rownames(se)[decode(seqnames(rowRanges(se)) %in% c("X", "Y"))]
length(xygenes)
```

Build a contingency table and conduct a one-tailed Fisher's exact test that
verifies the association between genes being DE between males and females and
being located in a sex chromosome.

```{r}
N <- nrow(se)
n <- length(sexDEgenes)
m <- length(xygenes)
k <- length(intersect(xygenes, sexDEgenes)) 
dnames <- list(GS=c("inside", "outside"), DE=c("yes", "no"))
t <- matrix(c(k, n-k, m-k, N+k-n-m),
                        nrow=2, ncol=2, dimnames=dnames)
t
fisher.test(t, alternative="greater")
```
